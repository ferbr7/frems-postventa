<div class="max-w-7xl mx-auto px-6 py-8">
  <!-- Header -->
  <div class="rounded-2xl bg-gradient-to-r from-emerald-700 to-emerald-600 p-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-white">{{ title }}</h1>
      <p class="text-emerald-100">{{ subtitle }}</p>
    </div>
    <a routerLink="/productos"
       class="rounded-xl border border-emerald-200/50 bg-emerald-600/30 text-white px-4 py-2 hover:bg-white/10">
      Volver
    </a>
  </div>

  <!-- Form -->
  <form (ngSubmit)="save()" [formGroup]="form"
        class="mt-6 bg-white rounded-2xl border border-slate-200 shadow p-6 grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Nombre -->
    <div>
      <label class="block text-slate-700 mb-2">Nombre *</label>
      <input formControlName="nombre" class="w-full rounded-xl border border-slate-300 px-4 py-2.5">
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('nombre')?.touched && form.get('nombre')?.invalid">
        Requerido.
      </p>
    </div>

    <!-- SKU (bloqueado en edición) -->
    <div>
      <label class="block text-slate-700 mb-2">SKU *</label>
      <input formControlName="sku" class="w-full rounded-xl border border-slate-300 px-4 py-2.5" [readonly]="isEdit">
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('sku')?.touched && form.get('sku')?.invalid">
        Requerido.
      </p>
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('sku')?.errors?.['duplicate']">
        Este SKU ya está en uso.
      </p>
    </div>

    <!-- Descripción -->
    <div class="md:col-span-2">
      <label class="block text-slate-700 mb-2">Descripción</label>
      <textarea formControlName="descripcion" rows="3"
                class="w-full rounded-xl border border-slate-300 px-4 py-2.5"></textarea>
    </div>

    <!-- Categoría -->
    <div>
      <label class="block text-slate-700 mb-2">Categoría *</label>
      <select formControlName="categoria" class="w-full rounded-xl border border-slate-300 px-4 py-2.5">
        <option value="">Selecciona una opción</option>
        <option *ngFor="let c of categorias" [value]="c">{{ c }}</option>
      </select>
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('categoria')?.touched && form.get('categoria')?.invalid">
        Requerido.
      </p>
    </div>

    <!-- Precio -->
    <div>
      <label class="block text-slate-700 mb-2">Precio *</label>
      <input type="number" step="0.01" min="0" formControlName="precioventa"
             (input)="onPrecioInput($event)"
             class="w-full rounded-xl border border-slate-300 px-4 py-2.5">
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('precioventa')?.touched && form.get('precioventa')?.invalid">
        Debe ser un número mayor o igual a 0.
      </p>
    </div>

    <!-- Medida -->
    <div>
      <label class="block text-slate-700 mb-2">Medida *</label>
      <select formControlName="medida" class="w-full rounded-xl border border-slate-300 px-4 py-2.5">
        <option value="">Selecciona una opción</option>
        <option *ngFor="let m of medidas" [value]="m">{{ m }}</option>
      </select>
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('medida')?.touched && form.get('medida')?.invalid">
        Requerido.
      </p>
    </div>

    <!-- Stock -->
    <div>
      <label class="block text-slate-700 mb-2">Stock *</label>
      <input type="number" min="0" step="1" formControlName="stock"
             (input)="onStockInput($event)"
             class="w-full rounded-xl border border-slate-300 px-4 py-2.5">
      <p class="text-sm text-rose-600 mt-1" *ngIf="form.get('stock')?.touched && form.get('stock')?.invalid">
        Debe ser un entero mayor o igual a 0.
      </p>
    </div>

    <!-- Estado -->
    <div class="flex items-center gap-3 mt-4">
      <label class="block text-slate-700">Estado</label>
      <label class="inline-flex items-center cursor-pointer">
        <input type="checkbox" formControlName="activo" class="sr-only peer" />
        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-emerald-500 rounded-full peer dark:bg-gray-700
             peer-checked:after:translate-x-full peer-checked:after:border-white
             after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all
             peer-checked:bg-emerald-600"></div>
      </label>
      <span class="ml-2 text-sm" [class.text-emerald-700]="form.get('activo')?.value" [class.text-red-500]="!form.get('activo')?.value">
        {{ form.get('activo')?.value ? 'Activo' : 'Inactivo' }}
      </span>
    </div>

    <!-- Duración estimada (opcional) -->
    <div class="md:col-span-2">
      <label class="block text-slate-700 mb-2">Duración estimada (días) — opcional</label>
      <input type="number" min="1" step="1" formControlName="duracionestimadodias"
             (input)="onDuracionInput($event)"
             class="w-full md:w-72 rounded-xl border border-slate-300 px-4 py-2.5">
      <p class="text-xs text-slate-500 mt-1">Útil para sugerencias de recompra. Deja vacío si no aplica.</p>
    </div>

    <!-- Botón -->
    <div class="md:col-span-2">
      <button *ngIf="!isView" type="submit"
              class="w-full rounded-2xl bg-emerald-600 text-white text-lg font-medium px-6 py-2.5 hover:bg-emerald-700"
              [disabled]="form.invalid">
        {{ isEdit ? 'Guardar cambios' : 'Registrar Nuevo Producto' }}
      </button>
    </div>
  </form>
</div>
