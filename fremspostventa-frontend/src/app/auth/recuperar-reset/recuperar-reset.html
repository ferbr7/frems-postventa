<div class="min-h-screen bg-neutral-50 flex items-center justify-center px-4">
  <div class="w-full max-w-md bg-white rounded-2xl shadow p-8">

    <h1 class="text-2xl font-semibold text-center text-slate-800 mb-2">
      Restablecer contraseña
    </h1>
    <p class="text-center text-slate-600 mb-6" *ngIf="showCode; else firstLoginMsg">
      Ingresa el código de 6 dígitos que enviamos a tu correo y establece tu nueva contraseña.
    </p>
    <ng-template #firstLoginMsg>
      <p class="text-center text-slate-600 mb-6">
        Establece tu nueva contraseña para continuar.
      </p>
    </ng-template>

    <!-- Email destino (solo lectura) -->
    <div class="mb-5" *ngIf="showCode">
      <label class="block text-slate-700 mb-2">Correo</label>
      <input [value]="email" disabled
             class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-2.5 text-slate-600 cursor-not-allowed" />
    </div>

    <form (ngSubmit)="restablecer()" [formGroup]="form" class="space-y-5"
          [class.opacity-60]="isLoading" [class.pointer-events-none]="isLoading">

      <!-- Código (solo cuando NO es primer login) -->
      <div *ngIf="showCode">
        <label class="block text-slate-700 mb-2">Código de verificación</label>
        <input type="text"
               inputmode="numeric"
               autocomplete="one-time-code"
               maxlength="6"
               pattern="[0-9]{6}"
               formControlName="codigo"
               class="w-full rounded-xl border border-slate-300 px-4 py-2.5 text-center tracking-[0.5em] text-lg font-semibold focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none" />
        <div class="mt-1 text-sm text-rose-600" *ngIf="form.get('codigo')?.touched && form.get('codigo')?.invalid">
          Ingresa un código válido de 6 dígitos.
        </div>
        <div class="mt-1 text-sm text-rose-600" *ngIf="form.get('codigo')?.hasError('invalid')">
          Código inválido o vencido.
        </div>
      </div>

      <!-- Nueva contraseña -->
      <div>
        <label class="block text-slate-700 mb-2">Nueva contraseña</label>
        <input type="password"
               autocomplete="new-password"
               formControlName="nuevaContrasena"
               class="w-full rounded-xl border border-slate-300 px-4 py-2.5 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none" />
        <div class="mt-1 text-sm text-rose-600" *ngIf="form.get('nuevaContrasena')?.touched && form.get('nuevaContrasena')?.hasError('weak')">
          Debe tener al menos 8 caracteres, una mayúscula, una minúscula, un número y un caracter especial.
        </div>
      </div>

      <!-- Confirmar contraseña -->
      <div>
        <label class="block text-slate-700 mb-2">Confirmar contraseña</label>
        <input type="password"
               autocomplete="new-password"
               formControlName="confirmarContrasena"
               class="w-full rounded-xl border border-slate-300 px-4 py-2.5 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none" />
        <div class="mt-1 text-sm text-rose-600"
             *ngIf="form.get('confirmarContrasena')?.touched && form.get('confirmarContrasena')?.invalid">
          Confirma tu contraseña.
        </div>
        <div class="mt-1 text-sm text-rose-600"
             *ngIf="form.get('confirmarContrasena')?.hasError('mismatch')">
          Las contraseñas no coinciden.
        </div>
      </div>

      <button type="submit"
              [disabled]="form.invalid || isLoading || (showCode && !email)"
              class="w-full rounded-xl bg-emerald-600 text-white text-lg font-medium px-6 py-2.5 hover:bg-emerald-700 transition disabled:opacity-60 disabled:cursor-not-allowed">
        {{ isLoading ? 'Cambiando…' : 'Cambiar contraseña' }}
      </button>
    </form>

    <div class="text-center mt-5" >
      <button type="button" (click)="backToLogin()"
              class="text-emerald-700 hover:text-emerald-800 font-medium">
        Volver al login
      </button>
    </div>
  </div>
</div>
